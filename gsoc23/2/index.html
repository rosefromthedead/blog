<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><title>//TODO(rose) | GSoC status report 2</title><link href=https://blog.krx.sh/theme.css rel=stylesheet><link href=https://blog.krx.sh/atom.xml rel=alternate title=RSS type=application/atom+xml><body><div id=main><div class=sidebar><div class=sidebar-inner><h1>//TODO(rose)</h1><p><a href=/> homepage </a> <br> <a href=/about/> about me </a> <br> <a href=https://sr.ht/~roseh>sourcehut</a></div></div><div class=content><article><h1>GSoC status report 2</h1><p>The world tried to stop me, but I pushed through and got some work done on wlroots.</p><span id=continue-reading></span><h2 id=hurdles><a aria-label="Anchor link for: hurdles" class=anchor-link href=#hurdles>#</a> Hurdles</h2><p>Unfortunately aside from programming I have a physical form that I have to take care of. Recently this form's hands have been hurting because of strain from typing, which is pretty rude of them, so I took some time out to build <a href=https://splitkb.com/collections/keyboard-kits/products/kyria-rev3-pcb-kit>a keyboard</a>. Woe is me, having to spend my time soldering and cutting. I had a great time. After finishing the keyboard, all of a sudden it was time to move out, so we packed and shuffled and drove and unpacked and complained about the trains in this country. Then I slept, and yesterday I finally found the time to get back to work. This is why there was no update last week.<h2 id=progress><a aria-label="Anchor link for: progress" class=anchor-link href=#progress>#</a> Progress</h2><p>I've decided that I need consistent terms for the subtasks I have. So: <em>measurement</em> is reading how long a frame takes to render, <em>prediction</em> is coming up with a number of milliseconds, and <em>scheduling</em> is delaying by that number and all the API funk therein. It turns out that Simon was right and there is a lot of API funk for me to deal with. We've had some discussions about <a href=https://gitlab.freedesktop.org/wlroots/wlroots/-/issues/3664>what exactly <code>wlr_output.events.frame</code> is for</a> and whether we really need it, and I've <a href=https://gitlab.freedesktop.org/rosefromthedead/wlroots/-/tree/scheduling>implemented a scheduling mechanism</a> based on that signal to show how we can make good use of it.<p><a href=https://gitlab.freedesktop.org/rosefromthedead/wlroots/-/tree/experiments>Bringing together</a> this scheduling, the timer from the first status report for measurement, and some naive prediction (next frame takes at most 1ms more than last frame) christens tinywl as the first user of all this mess. Here are some screenshots from <a href=https://github.com/mikesart/gpuvis>GPUVis</a> showing the old, boring timeline where we rendered immediately after the last present, and the new, sexy timeline where we render immediately before the next one! The purple lines are vblanks, and the boxes in each row represent durations when those processes were running on the CPU. I think blue lines are GPU submissions, but the naming is unclear.<p><img src=https://blog.krx.sh/processed_images/tinywl-before.8c120fcfbc9d96b4.png> <img src=https://blog.krx.sh/processed_images/tinywl-after.9797a59343db53a3.png><p>Wow, isn't that beautiful.</article></div></div>